<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Naive RAG 标准流程图</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f8fafc;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      margin: 0;
    }
    h2 { margin-bottom: 5px; color: #333; }
    .legend { font-size: 12px; color: #666; margin-bottom: 20px; display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; }
    .legend-item { display: flex; align-items: center; gap: 5px; }
    svg { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-radius: 8px; }
    text { font-family: sans-serif; font-size: 13px; fill: #333; }
    .label { font-weight: bold; }
    .sub-label { font-size: 10px; fill: #666; }
  </style>
</head>
<body>
  <h2>Naive RAG 标准流程图</h2>
  <div class="legend">
    <div class="legend-item">
      <svg width="20" height="20"><rect x="2" y="5" width="16" height="10" stroke="black" fill="none"/></svg> 矩形 = 处理步骤
    </div>
    <div class="legend-item">
      <svg width="20" height="20"><polygon points="4,15 16,15 20,5 8,5" stroke="black" fill="none"/></svg> 平行四边形 = 输入/输出
    </div>
    <div class="legend-item">
      <svg width="20" height="20"><path d="M4,5 A6,2 0 1,1 16,5 A6,2 0 1,1 4,5 M4,5 L4,15 A6,2 0 1,0 16,15 L16,5" stroke="black" fill="none"/></svg> 圆柱体 = 数据库
    </div>
  </div>

  <svg width="800" height="600" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L9,3 z" fill="#333" />
      </marker>
    </defs>

    <!-- 区域划分线 -->
    <line x1="400" y1="50" x2="400" y2="550" stroke="#ddd" stroke-width="2" stroke-dasharray="5,5" />
    <text x="200" y="40" font-size="16" font-weight="bold" text-anchor="middle" fill="#6366f1">离线阶段 (Indexing)</text>
    <text x="600" y="40" font-size="16" font-weight="bold" text-anchor="middle" fill="#8b5cf6">在线阶段 (Retrieval)</text>

    <!-- ================= 左侧：数据入库流程 ================= -->
    <!-- 1. Start -->
    <g transform="translate(150, 60)">
      <rect x="0" y="0" width="100" height="40" rx="20" ry="20" fill="#e0e7ff" stroke="#6366f1" stroke-width="1.5"/>
      <text x="50" y="25" text-anchor="middle">开始</text>
    </g>
    <line x1="200" y1="100" x2="200" y2="130" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)" />

    <!-- 2. Input (平行四边形) -->
    <g transform="translate(140, 130)">
      <polygon points="20,0 120,0 100,50 0,50" fill="#fff" stroke="#333" stroke-width="1.5"/>
      <text x="60" y="25" text-anchor="middle">文档输入</text>
      <text x="60" y="40" text-anchor="middle" class="sub-label">(PDF/Word)</text>
    </g>
    <line x1="200" y1="180" x2="200" y2="210" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)" />

    <!-- 3. Process (矩形) -->
    <g transform="translate(140, 210)">
      <rect x="0" y="0" width="120" height="50" fill="#fff" stroke="#333" stroke-width="1.5"/>
      <text x="60" y="25" text-anchor="middle">文档切块</text>
      <text x="60" y="40" text-anchor="middle" class="sub-label">(Chunking)</text>
    </g>
    <line x1="200" y1="260" x2="200" y2="290" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)" />

    <!-- 4. Process (矩形) - Embedding -->
    <g transform="translate(140, 290)">
      <rect x="0" y="0" width="120" height="50" fill="#fff" stroke="#333" stroke-width="1.5"/>
      <text x="60" y="25" text-anchor="middle">向量化 Embedding</text>
    </g>

    <!-- 连接到数据库 -->
    <path d="M 200 340 L 200 435 L 360 435" fill="none" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)" />

    <!-- ================= 中间：数据库 (圆柱体) ================= -->
    <g transform="translate(360, 400)">
      <ellipse cx="40" cy="10" rx="40" ry="10" fill="#c7d2fe" stroke="#6366f1" stroke-width="1.5"/>
      <path d="M0,10 L0,70 A40,10 0 0,0 80,70 L80,10" fill="#e0e7ff" stroke="#6366f1" stroke-width="1.5"/>
      <path d="M0,10 A40,10 0 0,0 80,10" fill="none" stroke="#6366f1" stroke-width="1.5"/>
      <text x="40" y="40" text-anchor="middle" font-weight="bold" fill="#4338ca">向量数据库</text>
      <text x="40" y="55" text-anchor="middle" class="sub-label">(Vector DB)</text>
    </g>

    <!-- ================= 右侧：用户检索流程 ================= -->
    <!-- 1. Start -->
    <g transform="translate(550, 60)">
      <rect x="0" y="0" width="100" height="40" rx="20" ry="20" fill="#f3e8ff" stroke="#8b5cf6" stroke-width="1.5"/>
      <text x="50" y="25" text-anchor="middle">用户提问</text>
    </g>
    <line x1="600" y1="100" x2="600" y2="130" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)" />

    <!-- 2. Input (平行四边形) -->
    <g transform="translate(540, 130)">
      <polygon points="20,0 120,0 100,50 0,50" fill="#fff" stroke="#333" stroke-width="1.5"/>
      <text x="60" y="30" text-anchor="middle">输入问题</text>
    </g>
    <line x1="600" y1="180" x2="600" y2="210" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)" />

    <!-- 3. Process (矩形) -->
    <g transform="translate(540, 210)">
      <rect x="0" y="0" width="120" height="50" fill="#fff" stroke="#333" stroke-width="1.5"/>
      <text x="60" y="30" text-anchor="middle">问题向量化</text>
    </g>
    <line x1="600" y1="260" x2="600" y2="290" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)" />

    <!-- 4. Process (矩形) - 检索 -->
    <g transform="translate(540, 290)">
      <rect x="0" y="0" width="120" height="50" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5"/>
      <text x="60" y="25" text-anchor="middle">相似度检索</text>
      <text x="60" y="40" text-anchor="middle" class="sub-label">(Top-K)</text>
    </g>

    <!-- 数据库提供数据给检索 -->
    <path d="M440,440 L500,440 L500,315 L540,315" stroke="#333" stroke-width="1.5" fill="none" stroke-dasharray="5,3" marker-end="url(#arrow)"/>
    <line x1="600" y1="340" x2="600" y2="370" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)" />

    <!-- 5. Process (矩形) -->
    <g transform="translate(540, 370)">
      <rect x="0" y="0" width="120" height="50" fill="#fff" stroke="#333" stroke-width="1.5"/>
      <text x="60" y="25" text-anchor="middle">构建 Prompt</text>
      <text x="60" y="40" text-anchor="middle" class="sub-label">(Prompt Template)</text>
    </g>
    <line x1="600" y1="420" x2="600" y2="450" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)" />

    <!-- 6. Process (矩形) - LLM -->
    <g transform="translate(540, 450)">
      <rect x="0" y="0" width="120" height="50" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="60" y="30" text-anchor="middle">LLM 生成回答</text>
    </g>
    <line x1="600" y1="500" x2="600" y2="530" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)" />

    <!-- 7. Output (平行四边形) -->
    <g transform="translate(540, 530)">
      <polygon points="20,0 120,0 100,50 0,50" fill="#dcfce7" stroke="#22c55e" stroke-width="1.5"/>
      <text x="60" y="30" text-anchor="middle">输出答案</text>
    </g>
  </svg>
</body>
</html>
