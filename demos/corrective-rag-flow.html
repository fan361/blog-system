<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Corrective RAG 流程图</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background-color: #f8fafc;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      margin: 0;
    }
    h2 { color: #2c3e50; margin-bottom: 5px; }
    .sub-title { color: #7f8c8d; margin-bottom: 25px; font-size: 14px; }
    svg { background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-radius: 8px; }
    text { font-family: 'Segoe UI', Arial, sans-serif; font-size: 13px; fill: #333; }
    .label-bold { font-weight: bold; font-size: 14px; }
  </style>
</head>
<body>
  <h2>Corrective RAG: 带"质检员"的检索流程</h2>
  <div class="sub-title">检索后评估文档质量，不合格则触发 Web 搜索补救</div>

  <svg width="800" height="780" viewBox="0 0 800 780" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L9,3 z" fill="#333" />
      </marker>
      <marker id="arrow-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L9,3 z" fill="#27ae60" />
      </marker>
      <marker id="arrow-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L9,3 z" fill="#c0392b" />
      </marker>
      <marker id="arrow-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L9,3 z" fill="#e67e22" />
      </marker>
      <marker id="arrow-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L9,3 z" fill="#3498db" />
      </marker>
    </defs>

    <!-- 1. 用户提问 -->
    <g transform="translate(340, 40)">
      <polygon points="20,0 140,0 120,50 0,50" fill="#e0e7ff" stroke="#6366f1" stroke-width="1.5"/>
      <text x="70" y="30" text-anchor="middle" class="label-bold">用户提问</text>
    </g>
    <line x1="410" y1="90" x2="410" y2="120" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- 初步检索 -->
    <g transform="translate(335, 120)">
      <rect x="0" y="0" width="150" height="50" rx="5" fill="#fff" stroke="#2c3e50" stroke-width="1.5"/>
      <text x="75" y="20" text-anchor="middle" class="label-bold">初步检索</text>
      <text x="75" y="40" text-anchor="middle" font-size="11" fill="#777">(获取原始 Chunk)</text>
    </g>
    <line x1="410" y1="170" x2="410" y2="210" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- 2. 检索评估器 (菱形) -->
    <g transform="translate(410, 260)">
      <polygon points="0,-50 80,0 0,50 -80,0" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
      <text x="0" y="-5" text-anchor="middle" class="label-bold" fill="#d97706">检索评估器</text>
      <text x="0" y="15" text-anchor="middle" font-size="11" fill="#d97706">(质检员)</text>
    </g>

    <!-- 3. 分流路径 -->
    
    <!-- Correct (绿) - 左边 -->
    <polyline points="330,260 200,260 200,350" fill="none" stroke="#27ae60" stroke-width="2" marker-end="url(#arrow-green)"/>
    <rect x="210" y="235" width="70" height="20" fill="white"/>
    <text x="245" y="250" text-anchor="middle" fill="#27ae60" font-weight="bold">Correct ✓</text>
    <g transform="translate(125, 350)">
      <rect x="0" y="0" width="150" height="60" rx="5" fill="#d1fae5" stroke="#27ae60" stroke-width="1.5"/>
      <text x="75" y="25" text-anchor="middle" class="label-bold" fill="#065f46">保留文档</text>
      <text x="75" y="45" text-anchor="middle" font-size="11" fill="#27ae60">直接使用</text>
    </g>

    <!-- Incorrect (红) - 右边 -->
    <polyline points="490,260 620,260 620,350" fill="none" stroke="#c0392b" stroke-width="2" marker-end="url(#arrow-red)"/>
    <rect x="530" y="235" width="75" height="20" fill="white"/>
    <text x="567" y="250" text-anchor="middle" fill="#c0392b" font-weight="bold">Incorrect ✗</text>
    <g transform="translate(545, 350)">
      <rect x="0" y="0" width="150" height="60" rx="5" fill="#fee2e2" stroke="#c0392b" stroke-width="1.5"/>
      <text x="75" y="25" text-anchor="middle" class="label-bold" fill="#991b1b">丢弃文档</text>
      <text x="75" y="45" text-anchor="middle" font-size="11" fill="#c0392b">质量不合格</text>
    </g>

    <!-- Ambiguous (橙) - 中间 -->
    <line x1="410" y1="310" x2="410" y2="350" stroke="#e67e22" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrow-orange)"/>
    <rect x="420" y="315" width="80" height="20" fill="white"/>
    <text x="460" y="330" text-anchor="middle" fill="#e67e22" font-weight="bold">Ambiguous ?</text>
    <g transform="translate(335, 350)">
      <rect x="0" y="0" width="150" height="60" rx="5" fill="#fef9c3" stroke="#e67e22" stroke-width="1.5"/>
      <text x="75" y="25" text-anchor="middle" class="label-bold" fill="#92400e">精炼/重写</text>
      <text x="75" y="45" text-anchor="middle" font-size="11" fill="#e67e22">提取关键信息</text>
    </g>

    <!-- 4. Web Search 云朵 -->
    <g transform="translate(400, 470)">
      <ellipse cx="0" cy="25" rx="90" ry="40" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
      <text x="0" y="20" text-anchor="middle" class="label-bold" fill="#1d4ed8">Web Search</text>
      <text x="0" y="38" text-anchor="middle" font-size="10" fill="#3b82f6">(Google / Bing)</text>
    </g>

    <!-- 红线：从"丢弃文档"底部 → Web Search 右侧 -->
    <path d="M 620 410 L 620 495 L 495 495" fill="none" stroke="#c0392b" stroke-width="2" marker-end="url(#arrow-red)"/>
    
    <!-- 橙线：从"精炼/重写"底部 → Web Search 左侧 -->
    <path d="M 410 410 L 410 440 L 310 440 L 310 495" fill="none" stroke="#e67e22" stroke-width="2" marker-end="url(#arrow-orange)"/>

    <!-- 5. 聚合到 LLM -->
    
    <!-- 左侧绿线：保留文档 → LLM -->
    <path d="M 200 410 L 200 620 L 330 620" fill="none" stroke="#27ae60" stroke-width="2" marker-end="url(#arrow-green)"/>
    
    <!-- 蓝线：Web Search → LLM -->
    <path d="M 400 510 L 400 560 L 400 600" fill="none" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-blue)"/>

    <!-- LLM 生成 -->
    <g transform="translate(330, 600)">
      <rect x="0" y="0" width="150" height="60" rx="5" fill="#e0e7ff" stroke="#6366f1" stroke-width="1.5"/>
      <text x="75" y="25" text-anchor="middle" class="label-bold" fill="#4338ca">LLM 生成回答</text>
      <text x="75" y="45" text-anchor="middle" font-size="11" fill="#6366f1">综合所有信息</text>
    </g>
    
    <line x1="405" y1="660" x2="405" y2="700" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- 输出 -->
    <g transform="translate(340, 700)">
      <rect x="0" y="0" width="130" height="45" rx="22" ry="22" fill="#f0fdf4" stroke="#22c55e" stroke-width="1.5"/>
      <text x="65" y="28" text-anchor="middle" class="label-bold" fill="#166534">输出答案</text>
    </g>
  </svg>
</body>
</html>
